function SVG(t,e,i){if(!t)return this;this.version="0.1.6",this.canvas=S("#"+t),this.w=parseInt(e||this.canvas[0].offsetWidth),this.h=parseInt(i||this.canvas[0].offsetHeight),this.id=t,this.canvas.html('<svg height="'+this.h+'" version="1.1" width="'+this.w+'" viewBox="0 0 '+this.w+" "+this.h+'" xmlns="http://www.w3.org/2000/svg"><desc>Created by stuQuery SVG</desc></svg>'),this.paper=S(this.canvas.find("svg")[0]),this.nodes=new Array,this.clippaths=new Array,this.patterns=new Array;var s=this,r=0;function n(t){if(this.path=t,"string"==typeof(this.p=t)){var e;this.path=t,this.p=t,this.p+="0",this.p=this.p.match(/(^|[A-Za-z]| )[^ A-Za-z]+/g);var i=this.p[this.p.length-1];this.p[this.p.length-1]=i.substring(0,i.length-1);for(var s=0;s<this.p.length;s++)if(0==this.p[s].search(/[A-Za-z]/)?(e=this.p[s][0],this.p[s]=this.p[s].substr(1)):(" "==this.p[s][0]&&(this.p[s]=this.p[s].substr(1)),e=""),this.p[s]=[e,this.p[s].split(/\,/)],2==this.p[s][1].length)for(var r=0;r<this.p[s][1].length;r++)this.p[s][1][r]=parseFloat(this.p[s][1][r]);else this.p[s][1]=[]}else this.p=t,this.path=this.string(t);return this}n.prototype.string=function(){for(var t="",e=0;e<this.p.length;e++)t+=(this.p[e][0]?this.p[e][0]:" ")+(0<this.p[e][1].length?this.p[e][1].join(","):" ");return t},n.prototype.copy=function(){return new n(function t(e){var i,s,r;for(r in i=Array.isArray(e)?[]:{},e)s=e[r],i[r]="object"==typeof s?t(s):s;return i}(this.p))};s=this;function h(t){for(var e in this.transforms=[],this.orig={},this.events=new Array,t)this[e]=t[e];for(var e in t)this.orig[e]=t[e];return this.path&&(this.path=new n(this.path),this.d=this.path.string(),this.orig.path=this.path.copy(),this.orig.d=this.d),this.id=s.id+"-svg-node-"+r,r++,this}return h.prototype.on=function(t,e,i){return i||"function"!=typeof e||(i=e,e={}),this.events.push({type:t,attr:e,fn:i}),this},h.prototype.attr=function(t,e){for(a in e&&((t={})[t]=e),this.attributes||(this.attributes={}),this.el&&0!=this.el.length||(this.el=S("#"+this.id)),t)if("string"==typeof t[a]&&(t[a]=t[a].replace(/\"/g,"'")),this.attributes[a]=t[a],this.el.attr(a,t[a]),"path"==a&&this.el.attr("d",new n(t[a]).string()),"text"==this.type)for(var i=this.el.find("tspan"),s=0;s<i.length;s++)i[s].setAttribute("x",this.attributes.x||this.x);this.orig.attributes=JSON.parse(JSON.stringify(this.attributes));this.id;return this.attributes&&this.attributes.id&&(this.id=this.attributes.id),this},h.prototype.transform=function(t){void 0===t.length&&"object"==typeof t&&(t=[t]),this.transforms||(this.transforms=[]);for(var e=0;e<t.length;e++)this.transforms.push(t[e]);return this},h.prototype.update=function(){if(this.transforms&&0<this.transforms.length){this.orig.path&&(this.path=this.orig.path.copy());for(var t=0;t<this.transforms.length;t++)for(var e in this.transforms[t].props)this.orig[e]&&this[e]&&(this[e]=JSON.parse(JSON.stringify(this.orig[e])));this.orig.attributes&&(this.attributes=JSON.parse(JSON.stringify(this.orig.attributes)));for(t=0;t<this.transforms.length;t++)if("scale"==this.transforms[t].type){if("path"==this.type){for(var i=0;i<this.orig.path.p.length;i++)for(var s=0;s<this.orig.path.p[i][1].length;s++)this.path.p[i][1][s]*=this.transforms[t].props[s%2==0?"x":"y"];this.path.path=this.path.string(),this.d=this.path.path}else for(var e in console.log("here",t),this.transforms[t].props)this[e]&&(this[e]*=this.transforms[t].props[e]);if(this.attributes)for(var e in this.transforms[t].props)this.attributes[e]&&(this.attributes[e]*=this.transforms[t].props[e])}}return this},this.circle=function(t,e,i){return this.nodes.push(new h({cx:t,cy:e,r:i,type:"circle"})),this.nodes[this.nodes.length-1]},this.rect=function(t,e,i,s,r){return r?this.nodes.push(new h({x:t,y:e,width:i,height:s,r:r,rx:r,ry:r,type:"rect"})):this.nodes.push(new h({x:t,y:e,width:i,height:s,type:"rect"})),this.nodes[this.nodes.length-1]},this.path=function(t){return this.nodes.push(new h({path:t,type:"path"})),this.nodes[this.nodes.length-1]},this.text=function(t,e,i){return this.nodes.push(new h({x:t,y:e,type:"text",text:i})),this.nodes[this.nodes.length-1]},this.clip=function(t){return this.clippaths.push(new h(t)),this.clippaths[this.clippaths.length-1]},this.pattern=function(t){return this.patterns.push(t),this.patterns[this.patterns.length-1]},this}function HexMap(t){if(this.version="0.4",t=t||{},this._attr=t,0==S("#"+t.id).length)return console.log("Can't find the element to draw into (#"+t.id+")"),{};this.w=t.width||300,this.h=t.height||150,this.maxw=this.w,this.maxh=this.h,this.s=t.size||10,this.aspectratio=this.w/this.h,this.id=t.id,this.hexes={},this.min=0,this.max=1,this.padding="number"==typeof t.padding?t.padding:0,this.properties={size:"number"==typeof t.size?t.size:10};var e=.4*("number"==typeof t.size?t.size:10);for(var i in 0==S("#"+this.id+"-inner").length&&S("#"+this.id).append('<div id="'+this.id+'-inner"></div>'),this.el=S("#"+this.id+"-inner"),this.options={showgrid:"boolean"==typeof t.grid&&t.grid,showlabel:"boolean"!=typeof t.showlabel||t.showlabel,formatLabel:"function"==typeof t.formatLabel?t.formatLabel:function(t,e){return t.substr(0,3)},minFontSize:"number"==typeof t.minFontSize?t.minFontSize:4},this.style={default:{fill:"#cccccc","fill-opacity":this.options.showlabel?.5:1,"font-size":e,"stroke-width":1.5,"stroke-opacity":1,stroke:"#ffffff"},highlight:{fill:"#1DD3A7"},grid:{fill:"#aaa","fill-opacity":.1}},t.style)t.style[i]&&(this.style[i]||(this.style[i]={}),t.style[i].fill&&(this.style[i].fill=t.style[i].fill),t.style[i]["fill-opacity"]&&(this.style[i]["fill-opacity"]=t.style[i]["fill-opacity"]),t.style[i]["font-size"]&&(this.style[i]["font-size"]=t.style[i]["font-size"]),t.style[i].stroke&&(this.style[i].stroke=t.style[i].stroke),t.style[i]["stroke-width"]&&(this.style[i]["stroke-width"]=t.style[i]["stroke-width"]),t.style[i]["stroke-opacity"]&&(this.style[i]["stroke-opacity"]=t.style[i]["stroke-opacity"]));this.mapping={},this.load=function(t,e,i){return"function"!=typeof e||i||(i=e,e=""),"function"!=typeof i||("string"==typeof t?S(document).ajax(t,{complete:function(t){this.setMapping(t),"function"==typeof i&&i.call(this,{data:e})},error:this.failLoad,this:this,dataType:"json"}):"object"==typeof t&&(this.setMapping(t),"function"==typeof i&&i.call(this,{data:e}))),this};var a=this;return window.addEventListener("resize",function(t){a.resize()}),this.setHexStyle=function(t){var e,i=this.hexes[t],s=(e=this.style.default,JSON.parse(JSON.stringify(e))),r="";if(i.active&&(s.fill=i.fillcolour),i.hover&&(r+=" hover"),i.selected){for(var n in this.style.selected)s[n]=this.style.selected[n];r+=" selected"}return this.search.active&&(r+=i.highlight?" highlighted":" not-highlighted"),s.class="hex-cell"+r,i.attr(s),this.labels[t].attr({class:"hex-label"+r}),i},this.toFront=function(t){for(var e in this.hexes)this.hexes[e].selected&&(this.paper.paper[0].appendChild(this.hexes[e].el[0]),this.paper.paper[0].appendChild(this.labels[e].el[0]));return this.paper.paper[0].appendChild(this.hexes[t].el[0]),this.paper.paper[0].appendChild(this.labels[t].el[0]),this},this.regionToggleSelected=function(t,e){if(this.selected=this.selected==t?"":t,h=this.hexes[t],h.selected=!h.selected,this.setHexStyle(t),!h.selected&&e)for(region in this.hexes)this.hexes[region].selected&&(this.hexes[region].selected=!1,this.setHexStyle(region));return this},this.regionFocus=function(t){return h=this.hexes[t],h.hover=!0,this.setHexStyle(t),this.toFront(t),this},this.regionBlur=function(t){return h=this.hexes[t],h.hover=!1,this.setHexStyle(t),this},this.regionActivate=function(t){h=this.hexes[t],h.active=!0,this.setHexStyle(t)},this.regionDeactivate=function(t){h=this.hexes[t],h.active=!1,this.setHexStyle(t)},this.regionToggleActive=function(t){h=this.hexes[t],h.active=!h.active,this.setHexStyle(t)},this.selectRegion=function(t){for(region in this.selected=t,this.hexes)h=this.hexes[region],0<t.length&&0==region.indexOf(t)?h.selected=!0:h.selected=!1,this.setHexStyle(region);return this},this.on=function(t,e,i){return"function"!=typeof e||i||(i=e,e=""),"function"!=typeof i||(this.callback||(this.callback={}),this.callback[t]={fn:i,attr:e}),this},this.moveTo=function(t,e){if(this.selected){for(region in dq=t-this.mapping.hexes[this.selected].q,dr=e-this.mapping.hexes[this.selected].r,this.hexes)if(0==region.indexOf(this.selected)&&(this.hexes[region].selected=!0),this.hexes[region].selected){this.mapping.hexes[region].q+=dq,this.mapping.hexes[region].r+=dr;var i=this.drawHex(this.mapping.hexes[region].q,this.mapping.hexes[region].r);this.hexes[region].attr({path:i.path}).update(),this.options.showlabel&&this.labels[region]&&this.labels[region].attr({x:i.x,y:i.y+this.style.default["font-size"]/2,"clip-path":"hex-clip-"+this.mapping.hexes[region].q+"-"+this.mapping.hexes[region].r}).update(),this.hexes[region].selected=!1,this.setHexStyle(region)}this.selected=""}},this.size=function(t,e){return this.el.css({height:"",width:""}),t=Math.min(this.w,S("#"+this.id)[0].offsetWidth),this.el.css({height:t/this.aspectratio+"px",width:t+"px"}),this.paper=new SVG(this.id+"-inner",this.maxw,this.maxh),t=this.paper.w,e=this.paper.h,scale=t/this.w,this.properties.size=this.s*scale,this.w=t,this.h=e,this.transform={type:"scale",props:{x:t,y:e,cx:t,cy:e,r:t,"stroke-width":t}},this.el.css({height:"",width:""}),this},this.resize=function(){return this},this.initialized=function(){return this.create().draw(),S(".spinner").remove(),this},this.create=function(){return this.paper.clear(),this.constructed=!1,this},this.setMapping=function(t){this.mapping=t,this.properties||(this.properties={x:100,y:100}),this.properties.x=this.w/2,this.properties.y=this.h/2,this.setSize();var e=t.layout.split("-");return this.properties.shift=e[0],this.properties.orientation=e[1],this.initialized()},this.setSize=function(t){return t&&(this.properties.size=t),this.properties.s={cos:this.properties.size*Math.sqrt(3)/2,sin:.5*this.properties.size},this.properties.s.c=this.properties.s.cos.toFixed(2),this.properties.s.s=this.properties.s.sin.toFixed(2),this},this.drawHex=function(t,e,i){if(this.properties){"number"!=typeof i&&(i=1),i=Math.sqrt(i);var s=this.properties.x+t*this.properties.s.cos*2,r=this.properties.y-e*this.properties.s.sin*3;"r"==this.properties.orientation&&("odd"==this.properties.shift&&1==(1&e)&&(s+=this.properties.s.cos),"even"==this.properties.shift&&0==(1&e)&&(s+=this.properties.s.cos)),"q"==this.properties.orientation&&("odd"==this.properties.shift&&1==(1&t)&&(r+=this.properties.s.cos),"even"==this.properties.shift&&0==(1&t)&&(r+=this.properties.s.cos));var n=[["M",[s,r]]],h=this.properties.s.c*i,a=this.properties.s.s*i;return"r"==this.properties.orientation?(n.push(["m",[h,-a]]),n.push(["l",[-h,-a,-h,a,0,(this.properties.size*i).toFixed(2),h,a,h,-a]])):(n.push(["m",[-a,h]]),n.push(["l",[-a,-h,a,h,(this.properties.size*i).toFixed(2),0,a,h,-a,h]])),n.push(["z",[]]),{path:n,x:s,y:r}}return this},this.updateColours=function(){var t="function"==typeof this.setColours?this.setColours:function(){return this.style.default.fill};for(region in this.mapping.hexes)this.hexes[region].fillcolour=t.call(this,region),this.setHexStyle(region);return this},this.draw=function(){var t,e,i={r:{min:1e100,max:-1e100},q:{min:1e100,max:-1e100}};for(region in this.mapping.hexes)e=this.mapping.hexes[region].q,t=this.mapping.hexes[region].r,e>i.q.max&&(i.q.max=e),e<i.q.min&&(i.q.min=e),t>i.r.max&&(i.r.max=t),t<i.r.min&&(i.r.min=t);i.q.min-=this.padding,i.q.max+=this.padding,i.r.min-=this.padding,i.r.max+=this.padding,qp=(i.q.max+i.q.min)/2,rp=(i.r.max+i.r.min)/2,this.properties.x=this.w/2-2*this.properties.s.cos*qp,this.properties.y=this.h/2+3*this.properties.s.sin*rp,this.range=i;var s=function(t){var e="mouseover";if(t.data.hexmap.callback[e]){for(var i in t.data.hexmap.callback[e].attr)t.data[i]=t.data.hexmap.callback[e].attr[i];if("function"==typeof t.data.hexmap.callback[e].fn)return t.data.hexmap.callback[e].fn.call(this,t)}},r=function(t){var e="mouseout";if(t.data.hexmap.callback[e]){for(var i in t.data.hexmap.callback[e].attr)t.data[i]=t.data.hexmap.callback[e].attr[i];if("function"==typeof t.data.hexmap.callback[e].fn)return t.data.hexmap.callback[e].fn.call(this,t)}},n=function(t){var e="click";if(t.data.hexmap.callback[e]){for(var i in t.data.hexmap.callback[e].attr)t.data[i]=t.data.hexmap.callback[e].attr[i];if("function"==typeof t.data.hexmap.callback[e].fn)return t.data.hexmap.callback[e].fn.call(this,t)}};if(this.options.showgrid)for(this.grid=new Array,e=i.q.min;e<=i.q.max;e++)for(t=i.r.min;t<=i.r.max;t++)h=this.drawHex(e,t),this.grid.push(this.paper.path(h.path).attr({class:"hex-grid","data-q":e,"data-r":t,fill:this.style.grid.fill||"","fill-opacity":this.style.grid["fill-opacity"]||.1,stroke:this.style.grid.stroke||"#aaa","stroke-opacity":this.style.grid["stroke-opacity"]||.2})),this.grid[this.grid.length-1].on("mouseover",{type:"grid",hexmap:this,data:{r:t,q:e}},s).on("mouseout",{type:"grid",hexmap:this,me:a,data:{r:t,q:e}},r).on("click",{type:"grid",hexmap:this,region:region,me:a,data:{r:t,q:e}},n),this.paper.clip({path:h.path,type:"path"}).attr({id:"hex-clip-"+e+"-"+t});for(region in this.values={},this.mapping.hexes){this.values[region]=(this.mapping.hexes[region].p-5e4)/3e4,this.values[region].value<0&&(this.values[region]=0),1<this.values[region].value&&(this.values[region]=1);var h=this.drawHex(this.mapping.hexes[region].q,this.mapping.hexes[region].r);this.constructed||(this.hexes[region]=this.paper.path(h.path).attr({class:"hex-cell","data-q":this.mapping.hexes[region].q,"data-r":this.mapping.hexes[region].r}),this.hexes[region].selected=!1,this.hexes[region].active=!0,this.hexes[region].attr({id:"hex-"+region}),this.hexes[region].on("mouseover",{type:"hex",hexmap:this,region:region,data:this.mapping.hexes[region],pop:this.mapping.hexes[region].p},s).on("mouseout",{type:"hex",hexmap:this,region:region,me:this.hexes[region]},r).on("click",{type:"hex",hexmap:this,region:region,me:this.hexes[region],data:this.mapping.hexes[region]},n),this.options.showlabel&&(this.labels||(this.labels={}),this.style.default["font-size"]>this.options.minFontSize&&(this.labels[region]=this.paper.text(h.x,h.y+this.style.default["font-size"]/2,this.options.formatLabel(this.mapping.hexes[region].n,{size:this.properties.size,"font-size":this.style.default["font-size"]})).attr({"clip-path":"hex-clip-"+this.mapping.hexes[region].q+"-"+this.mapping.hexes[region].r,"data-q":this.mapping.hexes[region].q,"data-r":this.mapping.hexes[region].r,class:"hex-label","text-anchor":"middle","font-size":this.style.default["font-size"]+"px",title:this.mapping.hexes[region].n||region}),this.labels[region].attr({id:"hex-"+region+"-label"}))),this.labels[region].on("mouseover",{type:"hex",hexmap:this,region:region,data:this.mapping.hexes[region],pop:this.mapping.hexes[region].p},s).on("mouseout",{type:"hex",hexmap:this,region:region,me:this.labels[region]},r).on("click",{type:"hex",hexmap:this,region:region,me:this.labels[region],data:this.mapping.hexes[region]},n)),this.setHexStyle(region),this.hexes[region].attr({stroke:this.style.default.stroke,"stroke-opacity":this.style.default["stroke-opacity"],"stroke-width":this.style.default["stroke-width"],title:this.mapping.hexes[region].n,"data-regions":region,style:"cursor: pointer;"}),this.hexes[region].update()}return this.constructed||this.paper.draw(),this.constructed=!0,this},S(document).on("keypress",{me:this},function(t){t.stopPropagation(),99==t.originalEvent.charCode&&t.data.me.selectBySameColour(t)}),this.selectBySameColour=function(){if(this.selected)for(region in this.hexes)this.hexes[region].fillcolour==this.hexes[this.selected].fillcolour&&(this.hexes[region].selected=!0,this.setHexStyle(region));return this},this.size(),t.file&&this.load(t.file),this.search=new function(t){return t=t||{},this.attr=t,this.el="",this.active=!1,this.selected=-1,this.init=function(){this.attr.id&&(this.el=S("#"+this.attr.id)),0==this.el.length&&(S("#"+hexmap.id).append('<div class="hex-search"></div>'),this.el=S("#"+a.id+" .hex-search")),0==this.el.find(".search-input").length&&this.el.append('<input type="text" class="search-input" name="constituencies" id="constituencies" value="">'),0==this.el.find(".search-button").length&&this.el.append('<button class="search-button"></button>'),this.el.find(".search-button").on("click",{hexmap:a,me:this},function(t){t.data.me.selected=-1,t.data.me.toggle()}),this.el.find(".search-input").on("keyup",{hexmap:a,me:this},function(t){var e=t.currentTarget.value.toLowerCase(),i={},s="",r=0;if(1<e.length)for(var n in t.data.hexmap.hexes)0<=t.data.hexmap.hexes[n].attributes.title.toLowerCase().indexOf(e)&&(i[n]=!0,r<8&&(s+='<li><a href="#" data="'+n+'">'+t.data.hexmap.hexes[n].attributes.title+"</a></li>",r++));40==t.originalEvent.keyCode||38==t.originalEvent.keyCode?(40==t.originalEvent.keyCode&&t.data.me.selected++,38==t.originalEvent.keyCode&&t.data.me.selected--,r=t.data.me.el.find(".search-results a").length,t.data.me.selected<0&&(t.data.me.selected=0),t.data.me.selected>=r&&(t.data.me.selected=r-1),t.data.me.el.find(".search-results a").removeClass("selected"),S(t.data.me.el.find(".search-results a")[t.data.me.selected]).addClass("selected")):13==t.originalEvent.keyCode?t.data.me.el.find(".search-results a.selected").trigger("click"):(0==t.data.me.el.find(".search-results").length&&t.data.me.el.find(".search-input").after('<ul class="search-results">BLAH</ul>'),t.data.me.el.find(".search-results").html(s),t.data.me.el.find(".search-results a").on("click",{me:t.data.me,builder:t.data.hexmap},function(t){t.preventDefault(),t.stopPropagation(),t.data.builder.hexes[t.currentTarget.getAttribute("data")].el.trigger("click"),t.data.me.el.find(".search-results").remove()}),t.data.me.highlight(i))})},this.toggle=function(){if(this.active=!this.active,this.active){this.el.addClass("searching"),this.el.find(".search-input")[0].focus();var t=this.el.find(".search-input")[0].value;this.el.find(".search-input")[0].value="",this.el.find(".search-input")[0].value=t,this.el.find(".search-input")[0].value&&this.el.find(".search-input").trigger("keyup")}else this.el.removeClass("searching"),this.highlight({}),this.el.find(".search-results").remove()},this.highlight=function(t){for(var e in this.n=0,t)this.n++;for(var e in a.hexes)0<this.n?t[e]?(a.hexes[e].highlight=!0,a.hexes[e].attr({class:"hex-cell highlighted"})):(a.hexes[e].highlight=!1,a.hexes[e].attr({class:"hex-cell not-highlighted"})):(a.hexes[e].highlight=!1,a.hexes[e].attr({class:"hex-cell"}));return this},this.init(),this}(t.search),this}function Colour(t,e){if(!t)return{};function i(t){return(t<16?"0":"")+t.toString(16)}function s(t){return parseInt(t,16)}if(this.alpha=1,0==t.indexOf("#"))this.hex=t,this.rgb=[s(t.substring(1,3)),s(t.substring(3,5)),s(t.substring(5,7))];else{if(0!=t.indexOf("rgb"))return{};var r=t.match(/[0-9\.]+/g);4==r.length&&(this.alpha=parseFloat(r[3])),this.rgb=[parseInt(r[0]),parseInt(r[1]),parseInt(r[2])],this.hex="#"+i(this.rgb[0])+i(this.rgb[1])+i(this.rgb[2])}var n,h;for(this.hsv=function(t,e,i){t/=255,e/=255,i/=255;var s,r,n=Math.max(t,e,i),h=Math.min(t,e,i),a=n,o=n-h;if(r=0==n?0:o/n,n==h)s=0;else{switch(n){case t:s=(e-i)/o+(e<i?6:0);break;case e:s=(i-t)/o+2;break;case i:s=(t-e)/o+4}s/=6}return[s,r,a]}(this.rgb[0],this.rgb[1],this.rgb[2]),this.name=e||"Name",h=n=0;n<this.rgb.length;n++)200<this.rgb[n]&&h++;return this.text=500<this.rgb[0]+this.rgb[1]+this.rgb[2]||1<h?"black":"white",this}function ResultsMap(id,attr){if(attr=attr||{},attr.padding||(attr.padding=0),!(attr.width&&attr.height&&attr.file&&attr.views))return{};this.w=attr.width,this.h=attr.height,this.aspectratio=attr.width/attr.height,this.id=id,this.type="",this.files={},this.views=attr.views,0<S("#data-selector").length&&(this.type=S("#data-selector")[0].value),0<S(".view-toggle").length&&(this.type=document.querySelector('input[name="view"]:checked').id),this.defaulttype=this.type;var t=location.search.replace(/\?/,"");if(t){var options=S("#data-selector option");if(0<options.length){for(var ok=!1,v="",i=0;i<options.length;i++)options[i].getAttribute("value")==t&&(ok=!0);ok&&(S("#data-selector")[0].value=t,this.type=t)}else{var options=S(".view-toggle");if(0<options.length)for(var v="",i=0;i<options.length;i++)options[i].getAttribute("id")==t&&(options[i].checked=!0,this.type=t)}}attrhex=JSON.parse(JSON.stringify(attr)),attrhex.id=id,attrhex.size=16,this.hex=new HexMap(attrhex),this.pushstate=!(!window.history||!history.pushState);var _obj=this;function CSV2JSON(data,format,start,end){"number"!=typeof start&&(start=1);var delim=",",lines=CSVToArray(data);"number"!=typeof end&&(end=lines.length);var header=lines[0],simpleheader=JSON.parse(JSON.stringify(header)),line,datum,key,key2,f,i,newdata=new Array,lookup={};if(format){for(i in format)key=i.replace(/ /g,"").toLowerCase(),lookup[key]=i+"";for(i=0;i<simpleheader.length;i++)simpleheader[i]=simpleheader[i].replace(/ /g,"").toLowerCase()}for(i=start;i<end;i++)if(line=lines[i],datum={},line){for(var j=0;j<line.length;j++)if(key=header[j],key2=simpleheader[j],format&&lookup[key2])if(key=lookup[key2],f=format[key],format[key].name&&(key=format[key].name),"number"==f.format)""!=line[j]&&("infinity"==line[j]||"Inf"==line[j]?datum[key]=Number.POSITIVE_INFINITY:datum[key]=parseFloat(line[j]));else if("eval"==f.format)""!=line[j]&&(datum[key]=eval(line[j]));else if("date"==f.format)if(line[j]){line[j]=line[j].replace(/^"/,"").replace(/"$/,"");try{datum[key]=new Date(line[j])}catch(t){this.log.warning("Invalid date "+line[j]),datum[key]=new Date("0001-01-01")}}else datum[key]=null;else"boolean"==f.format?"1"==line[j]||"true"==line[j]||"Y"==line[j]?datum[key]=!0:"0"==line[j]||"false"==line[j]||"N"==line[j]?datum[key]=!1:datum[key]=null:datum[key]='"'==line[j][0]&&'"'==line[j][line[j].length-1]?line[j].substring(1,line[j].length-1):line[j];else datum[key]='"'==line[j][0]&&'"'==line[j][line[j].length-1]?line[j].substring(1,line[j].length-1):line[j];newdata.push(datum)}return newdata}function CSVToArray(t,e){e=e||",";for(var i=new RegExp("(\\"+e+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+e+"\\r\\n]*))","gi"),s=[[]],r=!1;r=i.exec(t);){var n,h=r[1];h.length&&h!==e&&s.push([]),n=r[2]?r[2].replace(new RegExp('""',"g"),'"'):r[3],s[s.length-1].push(n)}return s}function d2h(t){return(t<16?"0":"")+t.toString(16)}function h2d(t){return parseInt(t,16)}function Colour(t,e){if(!t)return{};if(this.alpha=1,0==t.indexOf("#"))this.hex=t,this.rgb=[h2d(t.substring(1,3)),h2d(t.substring(3,5)),h2d(t.substring(5,7))];else{if(0!=t.indexOf("rgb"))return{};var i=t.match(/[0-9\.]+/g);4==i.length&&(this.alpha=parseFloat(i[3])),this.rgb=[parseInt(i[0]),parseInt(i[1]),parseInt(i[2])],this.hex="#"+d2h(this.rgb[0])+d2h(this.rgb[1])+d2h(this.rgb[2])}var s,r;for(this.hsv=function(t,e,i){t/=255,e/=255,i/=255;var s,r,n=Math.max(t,e,i),h=Math.min(t,e,i),a=n,o=n-h;if(r=0==n?0:o/n,n==h)s=0;else{switch(n){case t:s=(e-i)/o+(e<i?6:0);break;case e:s=(i-t)/o+2;break;case i:s=(t-e)/o+4}s/=6}return[s,r,a]}(this.rgb[0],this.rgb[1],this.rgb[2]),this.name=e||"Name",r=s=0;s<this.rgb.length;s++)200<this.rgb[s]&&r++;return this.text=500<this.rgb[0]+this.rgb[1]+this.rgb[2]||1<r?"black":"white",this}function getColour(t,e,i){return i=i||e,"rgb("+parseInt(e.rgb[0]+(i.rgb[0]-e.rgb[0])*t)+","+parseInt(e.rgb[1]+(i.rgb[1]-e.rgb[1])*t)+","+parseInt(e.rgb[2]+(i.rgb[2]-e.rgb[2])*t)+")"}function makeGradient(t,e){return e=e||t,"background: "+t.hex+"; background: -moz-linear-gradient(left, "+t.hex+" 0%, "+e.hex+" 100%);background: -webkit-linear-gradient(left, "+t.hex+" 0%,"+e.hex+" 100%);background: linear-gradient(to right, "+t.hex+" 0%,"+e.hex+" 100%);"}function setTextColor(t){if(!t)return"";var e=getL(t=new Colour(t).hex),i=getL("#000000"),s=getL("#ffffff"),r=(Math.max(e,i)+.05)/(Math.min(e,i)+.05),n=(Math.max(e,s)+.05)/(Math.min(e,s)+.05);return e==s?"#000000":n<r?"#000000":"#FFFFFF"}function getL(t){return.2126*getsRGB(t.substr(1,2))+.7152*getsRGB(t.substr(3,2))+.0722*getsRGB(t.substr(-2))}function getRGB(e){try{e=parseInt(e,16)}catch(t){e=!1}return e}function getsRGB(t){return t=(t=getRGB(t)/255)<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)}return this.pushstate&&(window[this.pushstate?"onpopstate":"onhashchange"]=function(t){t.state&&t.state.type?_obj.updateData(t.state.type):_obj.updateData(_obj.defaulttype)}),this.hex.load(attr.file,{me:this},function(t){t.data.me.setType(t.data.me.type,t.data.me.type!=t.data.me.defaulttype)}),window.addEventListener("message",function(t){_obj.iframe=t.data,_obj.positionBubble()},!1),this.positionBubble=function(){this.iframe&&0<S(".infobubble").length&&S(".infobubble").css({top:"calc("+(0<this.iframe.top?this.iframe.top:0)+"px + 1em)","max-height":this.iframe.height+"px"})},this.setType=function(t,e){return t==this.by?console.log("no change"):(this.pushstate&&history.pushState({type:t},"Hexes",e?"?"+t:""),this.updateData(t)),this},this.startPolling=function(t){this.views[t].live?(console.info("Start loop for "+t),(_obj=this).polling=window.setInterval(function(){_obj.loadResults(t,function(t){this.setColours(t)})},6e4)):this.polling&&(console.info("Stop loop"),clearInterval(this.polling))},this.updateData=function(t){return this.polling&&(console.info("Stop loop"),clearInterval(this.polling)),this.data&&this.data[t]?(this.setColours(t),this.views[t].live&&this.startPolling(t),this):this.loadResults(t,function(t){this.setColours(t),this.views[t].live&&this.startPolling(t)})},this.hex.on("mouseover",{builder:this},function(t){t.data.hexmap.regionFocus(t.data.region),0==S("#tooltip").length&&S("#"+t.data.builder.id+"-inner").append('<div id="tooltip"></div>');var e=S("#tooltip");e.html(t.data.builder.hex.hexes[t.data.region].attributes.title+"</div>");var i=t.data.builder.hex.hexes[t.data.region].el[0].getBoundingClientRect();e.css({position:"absolute",left:Math.round(i.left+i.width/2-S("#"+t.data.builder.id)[0].offsetLeft)+"px",top:Math.round(i.y+i.height+window.scrollY-S("#"+t.data.builder.id)[0].offsetTop)+"px"})}).on("mouseout",{builder:this},function(t){t.data.hexmap.regionBlur(t.data.region),S("#tooltip").remove()}).on("click",{builder:this},function(t){t.data.builder.openActive(t.data.region)}),this.closeActive=function(){return this.hex.selected="",this.hex.selectRegion(""),S(".infobubble").remove(),S("body").removeClass("modal"),this},this.openActive=function(t){var e=this.hex.selected,i=t;return this.hex.search.active&&this.hex.search.toggle(),this.label(t,e!=i),this.hex.selectRegion(t),this},this.label=function(t,e){var i=this.views[this.by];if(!i)return this;var a=i.popup,s=this.hex.hexes[t].el[0].getAttribute("title");function r(t,e,i){this.hex.mapping.hexes[e].label;var s={},r=(s=a&&"function"==typeof a.render?a.render.call(this,t,e,i):(console.warn("No view for "+this.by),{label:t,class:cls,color:""})).color||"",n=s.color?setTextColor(r):"black",h=s.label;return h=h.replace(/%COLOR%/g,n),S(".infobubble_inner").html(h).css({width:s.w?s.w+"px":"",height:s.h?s.h+"px":""}),S(".infobubble").attr("class","infobubble"+(s.class?" "+s.class:"")),S(".infobubble .close").remove(),S(".infobubble").prepend('<button class="close button" title="Close constituency information">&times;</button>'),S(".infobubble .close").on("click",{me:this},function(t){t.data.me.closeActive()}),"function"==typeof s.callback&&s.callback.call(this,t,e,i),this}return e&&(S(".infobubble").remove(),S("#"+this.id).after('<div class="infobubble generalelection"><div class="infobubble_inner"><div class="spinner"><svg width="64" height="64" viewBox="-32 -32 64 64" xmlns="http://www.w3.org/2000/svg" style="transform-origin: center center;"><style>#odilogo-starburst rect2 { transform-origin: center center; -webkit-transform-origin: center center; }</style><g id="odilogo-starburst"><rect width="4" height="25" x="-2" transform="rotate(7)" fill="#2254F4"><animate attributeName="height" begin="0s" dur="4s" values="25;19;23;29;26;25;31;21;25" calcMode="linear" repeatCount="indefinite" /></rect><rect width="4" height="25" x="-2" transform="rotate(27)" fill="#F9BC26"><animate attributeName="height" begin="0s" dur="2s" values="25;29;23;20;25" calcMode="linear" repeatCount="indefinite" /></rect><rect width="4" height="25" x="-2" transform="rotate(47)" fill="#00B6FF"><animate attributeName="height" begin="0s" dur="1s" values="25;20;27;25;" calcMode="linear" repeatCount="indefinite" /></rect><rect width="4" height="25" x="-2" transform="rotate(67)" fill="#D60303"><animate attributeName="height" begin="0s" dur="5s" values="25;15;27;25;32;16;24;27;18;32;25" calcMode="linear" repeatCount="indefinite" /></rect><rect width="4" height="25" x="-2" transform="rotate(87)" fill="#722EA5"><animate attributeName="height" begin="0s" dur="6s" values="25;19;26;30;21;24;29;27;15;23;20;29;25" calcMode="linear" repeatCount="indefinite" /></rect><rect width="4" height="25" x="-2" transform="rotate(107)" fill="#1DD3A7"><animate attributeName="height" begin="0s" dur="3s" values="25;27;24;32;23;19;25" calcMode="linear" repeatCount="indefinite" /></rect><rect width="4" height="25" x="-2" transform="rotate(127)" fill="#EF3AAB"><animate attributeName="height" begin="0s" dur="2s" values="25;20;22;32;25" calcMode="linear" repeatCount="indefinite" /></rect><rect width="4" height="25" x="-2" transform="rotate(147)" fill="#FF6700"><animate attributeName="height" begin="0s" dur="4s" values="25;24;18;23;27;23;29;21;25" calcMode="linear" repeatCount="indefinite" /></rect><rect width="4" height="25" x="-2" transform="rotate(167)" fill="#0DBC37"><animate attributeName="height" begin="0s" dur="4s" values="25;15;27;25;24;32;16;24;25" calcMode="linear" repeatCount="indefinite" /></rect><rect width="4" height="25" x="-2" transform="rotate(187)" fill="#178CFF"><animate attributeName="height" begin="0s" dur="5s" values="25;18;23;21;31;20;24;21;28;31;25" calcMode="linear" repeatCount="indefinite" /></rect><rect width="4" height="25" x="-2" transform="rotate(207)" fill="#722EA5"><animate attributeName="height" begin="0s" dur="3s" values="25;32;16;24;19;27;25" calcMode="linear" repeatCount="indefinite" /></rect><rect width="4" height="25" x="-2" transform="rotate(227)" fill="#D73058"><animate attributeName="height" begin="0s" dur="5s" values="25;23;25;28;18;27;24;30;31;28;25" calcMode="linear" repeatCount="indefinite" /></rect><rect width="4" height="25" x="-2" transform="rotate(247)" fill="#00B6FF"><animate attributeName="height" begin="0s" dur="4s" values="25;19;23;29;26;25;31;21;25" calcMode="linear" repeatCount="indefinite" /></rect><rect width="4" height="25" x="-2" transform="rotate(267)" fill="#67E767"><animate attributeName="height" begin="0s" dur="2s" values="25;29;23;20;25" calcMode="linear" repeatCount="indefinite" /></rect><rect width="4" height="25" x="-2" transform="rotate(287)" fill="#E6007C"><animate attributeName="height" begin="0s" dur="1s" values="25;20;27;25;" calcMode="linear" repeatCount="indefinite" /></rect><rect width="4" height="25" x="-2" transform="rotate(307)" fill="#0DBC37"><animate attributeName="height" begin="0s" dur="5s" values="25;15;27;25;32;16;24;27;18;32;25" calcMode="linear" repeatCount="indefinite" /></rect><rect width="4" height="25" x="-2" transform="rotate(327)" fill="#D60303"><animate attributeName="height" begin="0s" dur="6s" values="25;19;26;30;21;24;29;27;15;23;20;29;25" calcMode="linear" repeatCount="indefinite" /></rect><rect width="4" height="25" x="-2" transform="rotate(347)" fill="#08DEF9"><animate attributeName="height" begin="0s" dur="3s" values="25;27;24;32;23;19;25" calcMode="linear" repeatCount="indefinite" /></rect></g><g id="odilogo"><circle cx="-12.8" cy="0" r="6.4" style="fill:black;"></circle><path d="M-7 -6.4 l 6.4 0 c 0 0 6.4 0 6.4 6.4 c 0 6.4 -6.4 6.4 -6.4 6.4 L -7 6.4Z" style="fill:black;"></path><rect width="6.4" height="12.5" x="5.5" y="-6.25" style="fill:black;"></rect></g></svg></div></div></div>')),a.file?(console.info("Loading data for "+t,a.file.replace(/%region%/g,t)),S().ajax(a.file.replace(/%region%/g,t),{this:this,callback:r,dataType:0<a.file.indexOf(".json")?"json":"text",region:t,cache:"boolean"!=typeof a.live||!a.live,render:a.render,title:s,success:function(t,e){"text"==e.dataType&&(t=CSV2JSON(t)),this.positionBubble(),"function"==typeof e.callback&&e.callback.call(this,e.title,e.region,t)},error:function(t,e){console.error("Unable to load "+e.url),"function"==typeof e.callback&&e.callback.call(this,e.title,e.region)}})):r.call(this,s,t),S("body").addClass("modal"),this},S(".view-toggle").on("change",{me:this},function(t){t.data.me.setType(document.querySelector('input[name="view"]:checked').id,!0)}),S(document).on("keypress",function(t){}),this.loadResults=function(t,e){return t=t||"GE2015-results",this.data||(this.data={}),this.data[t]={},this.hex.data||(this.hex.data={}),this.hex.data[t]={},this.views[t]&&(console.info("Getting "+this.views[t].file),S().ajax(this.views[t].file,{this:this,callback:e,dataType:0<this.views[t].file.indexOf(".json")?"json":"text",type:t,cache:"boolean"!=typeof this.views[t].live||!this.views[t].live,process:this.views[t].process,success:function(t,e){"text"==e.dataType&&(t=CSV2JSON(t)),e.process.call(this,e.type,t),"function"==typeof e.callback&&e.callback.call(this,e.type)},error:function(t,e){console.error("Unable to load "+e.url),e.process.call(this,e.type,[]),"function"==typeof e.callback&&e.callback.call(this,e.type)}})),this},this.setColours=function(t){if(t=t||"",0<S("#data-selector").length&&(S("#data-selector")[0].value=t),0<S(".view-toggle").length)for(var e=S(".view-toggle"),i=0;i<e.length;i++)e[i].getAttribute("id")==t&&(e[i].checked=!0);this.by=t;var s="";return this.views[t]&&"function"==typeof this.views[t].key&&(s=this.views[t].key.call(this)),S("#key").html(s),this.hex.updateColours(),this.hex.selected&&this.label(this.hex.selected),this},this}!function(t){var f={};function e(h){for(var t in this.stuquery="1.0.25",this.getBy=function(t,e){var i,s,r;i=-1;var n=[];if(0<e.indexOf(":eq")&&(e=(s=e.replace(/(.*)\:eq\(([0-9]+)\)/,"$1 $2").split(" "))[0],i=parseInt(s[1])),(h=(h="."==e[0]?t.getElementsByClassName(e.substr(1)):"#"==e[0]?t.getElementById(e.substr(1)):t.getElementsByTagName(e))||[]).nodeName&&"SELECT"==h.nodeName)n.push(h);else{for("number"!=typeof h.length&&(h=[h]),r=0;r<h.length;r++)n.push(h[r]);0<=i&&0<n.length&&(n=i<n.length?[n[i]]:[])}return n},this.matchSelector=function(t,e){if("."==e[0]){e=e.substr(1);for(var i=0;i<t.classList.length;i++)if(t.classList[i]==e)return!0}else if("#"==e[0]){if(t.id==e.substr(1))return!0}else if(t.tagName==e.toUpperCase())return!0;return!1},"string"==typeof h?this.e=this.querySelector(document,h):"object"==typeof h&&(this.e="number"==typeof h.length?h:[h]),this.e)this.e[t]&&(this[t]=this.e[t]);return this.length=this.e?this.e.length:0,this}function s(t,e){if(t&&0<t.length)for(var i=0;i<t.length;i++)if(t[i].node==e)return{success:!0,match:i};return{success:!1}}function d(t){if(f[t.type]){var e=s(f[t.type],t.currentTarget);if(e.success)return e.match.data&&(t.data=f[t.type][e.match].data),{fn:f[t.type][e.match].fn,data:t}}return function(){return{fn:""}}}function i(t,e,i,s){for(var r=[],n=0;n<t.length;n++){r.push(t[n].getAttribute(e));var h=!1;for(var a in s)typeof i===s[a]&&(h=!0);h&&(i?t[n].setAttribute(e,i):t[n].removeAttribute(e))}return 1==r.length&&(r=r[0]),void 0===i?r:t}e.prototype.querySelector=function(t,e){var i,s,r,n,h,a,o=[];if(0<=e.indexOf(":eq"))for(i=e.split(" "),r=0;r<i.length;r++)if(0==r)a=this.getBy(t,i[r]);else{for(s=[],n=0;n<a.length;n++)s=s.concat(this.getBy(a[n],i[r]));a=s.splice(0)}else a=t.querySelectorAll(e);for(h=0;h<a.length;h++)o.push(a[h]);return o},e.prototype.ready=function(t){/in/.test(document.readyState)?setTimeout("S(document).ready("+t+")",9):t()},e.prototype.html=function(t){if("number"==typeof t&&(t=""+t),"string"!=typeof t&&1==this.length)return this[0].innerHTML;if("string"==typeof t)for(var e=0;e<this.length;e++)this[e].innerHTML=t;return this},e.prototype.append=function(t){if(!t&&1==this.length)return this[0].innerHTML;if(t)for(var e=0;e<this.length;e++){var i=document.createElement("template");i.innerHTML=t;var s=void 0===i.content?i:i.content;if(0<s.childNodes.length)for(;0<s.childNodes.length;)this[e].appendChild(s.childNodes[0]);else this[e].append(t)}return this},e.prototype.prepend=function(t){var e,i,s,r;if(!t&&1==this.length)return this[0].innerHTML;for(e=0;e<this.length;e++)for((s=document.createElement("div")).innerHTML=t,i=(r=s.childNodes).length-1;0<=i;i--)this[e].insertBefore(r[i],this[e].firstChild);return this},e.prototype.before=function(t){var e,i,s,r;for(e=0;e<this.length;e++)for((i=document.createElement("div")).innerHTML=t,s=i.childNodes,r=0;r<s.length;r++)this[e].parentNode.insertBefore(s[r],this[e]);return this},e.prototype.after=function(t){for(var e=0;e<this.length;e++)this[e].insertAdjacentHTML("afterend",t);return this},e.prototype.off=function(t){"function"!=typeof Element.prototype.removeEventListener&&(Element.prototype.removeEventListener=function(t,e){if(oListeners.hasOwnProperty(t)){for(var i=oListeners[t],s=-1,r=0;r<i.aEls.length;r++)if(i.aEls[r]===this){s=r;break}if(-1!==s)for(var n=0,h=i.aEvts[s];n<h.length;n++)h[n]===e&&h.splice(n,1)}});for(var e=0;e<this.length;e++){var i=s(f[t],this.e[e]);i.success&&(this[e].removeEventListener(t,f[t][i.match].fn2,!1),f[t].splice(i.match,1))}return this},e.prototype.on=function(i,s,t){var e,r,n,h,a,o=(i||window.event).split(/ /);if("function"!=typeof s||t||(t=s,s=""),"function"!=typeof t)return this;if(0<this.length)for(var l,p=this,c=0;c<o.length;c++){i=o[c],l=function(t){var e=d({currentTarget:this,type:i,data:s,originalEvent:t,preventDefault:function(){t.preventDefault&&t.preventDefault()},stopPropagation:function(){t.stopImmediatePropagation&&t.stopImmediatePropagation(),t.stopPropagation&&t.stopPropagation(),null!=t.cancelBubble&&(t.cancelBubble=!0)}});if("function"==typeof e.fn)return e.fn.call(p,e.data)};for(var u=0;u<this.length;u++)e=this[u],n=t,h=l,a=s,f[r=i]||(f[r]=[]),f[r].push({node:e,fn:n,fn2:h,data:a}),this[u].addEventListener?this[u].addEventListener(i,l,!1):this[u].attachEvent&&this[u].attachEvent(i,l)}return this},e.prototype.trigger=function(t){for(var e,i=t.split(/ /),s=0;s<i.length;s++){document.createEvent?(e=document.createEvent("HTMLEvents")).initEvent(i[s],!0,!0):(e=document.createEventObject()).eventType=i[s],e.eventName=t;for(var r=0;r<this.length;r++)document.createEvent?this[r].dispatchEvent(e):this[r].fireEvent("on"+e.eventType,e)}return this},e.prototype.focus=function(){return 1==this.length&&this[0].focus(),this},e.prototype.blur=function(){return 1==this.length&&this[0].blur(),this},e.prototype.remove=function(){if(this.length<1)return this;for(var t=this.length-1;0<=t;t--){if(!this[t])return;"function"==typeof this[t].remove?this[t].remove():"function"==typeof this[t].parentElement.removeChild&&this[t].parentElement.removeChild(this[t])}return this},e.prototype.hasClass=function(t){for(var e=!0,i=0;i<this.length;i++)this[i].className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))||(e=!1);return e},e.prototype.toggleClass=function(t){for(var e=0;e<this.length;e++)this[e].className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))?this[e].className=this[e].className.replace(new RegExp("(\\s|^)"+t+"(\\s|$)","g")," ").replace(/ $/,""):this[e].className=(this[e].className+" "+t).replace(/^ /,"");return this},e.prototype.addClass=function(t){for(var e=0;e<this.length;e++)this[e].className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))||(this[e].className=(this[e].className+" "+t).replace(/^ /,""));return this},e.prototype.removeClass=function(t){for(var e=0;e<this.length;e++)for(;this[e].className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"));)this[e].className=this[e].className.replace(new RegExp("(\\s|^)"+t+"(\\s|$)","g")," ").replace(/ $/,"").replace(/^ /,"");return this},e.prototype.css=function(t){var e,i,s;if(1==this.length&&"string"==typeof t)return(e=window.getComputedStyle(this[0]))[t];for(i=0;i<this.length;i++){if(e={},this[i].getAttribute("style"))for(var r=this[i].getAttribute("style").split(";"),n=0;n<r.length;n++){var h=r[n].split(":");2==h.length&&(e[h[0]]=h[1])}if("object"==typeof t){for(s in t)void 0!==t[s]&&(e[s]=t[s]);var a="";for(s in e)void 0!==e[s]&&(a&&(a+=";"),e[s]&&(a+=s+":"+e[s]));this[i].setAttribute("style",a)}}return this},e.prototype.parent=function(){for(var t=[],e=0;e<this.length;e++)t.push(this[e].parentElement);return S(t)},e.prototype.children=function(t){var e;if("string"==typeof t){var i=[];for(e=0;e<this.length;e++)for(var s=0;s<this[e].children.length;s++)this.matchSelector(this[e].children[s],t)&&i.push(this[e].children[s]);return S(i)}for(e=0;e<this.length;e++)this[e]=this[e].children.length>t?this[e].children[t]:this[e];return this},e.prototype.find=function(t){for(var e=[],i=0;i<this.length;i++)e=e.concat(this.querySelector(this[i],t));return S(e)},e.prototype.attr=function(t,e){return i(this,t,e,["string","number"])},e.prototype.prop=function(t,e){return i(this,t,e,["boolean"])},e.prototype.clone=function(){var t=document.createElement("div");return t.appendChild(this[0].cloneNode(!0)),t.innerHTML},e.prototype.replaceWith=function(t){for(var e,i=S(this.e),s=0;s<this.length;s++)(e=document.createElement("div")).innerHTML=t,i[s]=e.cloneNode(!0),this[s].parentNode.replaceChild(i[s],this[s]);return i},e.prototype.width=function(){if(!(1<this.length))return this[0].offsetWidth},e.prototype.height=function(){if(!(1<this.length))return this[0].offsetHeight},e.prototype.outerWidth=function(){if(!(1<this.length)){var t=getComputedStyle(this[0]);return this[0].offsetWidth+parseInt(t.marginLeft)+parseInt(t.marginRight)}},e.prototype.outerHeight=function(){if(!(1<this.length)){var t=getComputedStyle(this[0]);return this[0].offsetHeight+parseInt(t.marginTop)+parseInt(t.marginBottom)}},e.prototype.offset=function(){var t=this[0].getBoundingClientRect();return{top:t.top+document.body.scrollTop,left:t.left+document.body.scrollLeft}},e.prototype.position=function(){if(!(1<this.length))return{left:this[0].offsetLeft,top:this[0].offsetTop}},e.prototype.ajax=function(t,s){if("string"!=typeof t)return!1;s=s||{};var r,e,n="",i="";if(0<t.indexOf("?")&&(e=t.split("?")).length&&(t=e[0],i=e[1]),"jsonp"==s.dataType&&(n="fn_"+(new Date).getTime(),window[n]=function(t){"function"==typeof s.success&&s.success.call(s.this?s.this:this,t,s)}),"boolean"!=typeof s.cache||s.cache||(i+=(i?"&":"")+(new Date).valueOf()),n&&(i+=(i?"&":"")+"callback="+n),s.data&&(i+=(i?"&":"")+s.data),"POST"==s.method?s.url=t:s.url=t+(i?"?"+i:""),"jsonp"==s.dataType){var h=document.createElement("script");return h.src=s.url,document.body.appendChild(h),this}(r=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")).addEventListener("load",window[n]||function(t){var e;if(s.header=r.getAllResponseHeaders(),200==r.status||201==r.status||202==r.status){if(e=r.response,""!=r.responseType&&"text"!=r.responseType||(e=r.responseText),"json"==s.dataType)try{"string"==typeof e&&(e=JSON.parse(e.replace(/[\n\r]/g,"\\n").replace(/^([^\(]+)\((.*)\)([^\)]*)$/,function(t,e,i,s){return e==n?i:""}).replace(/\\n/g,"\n")))}catch(t){o(t)}if("script"==s.dataType){var i=document.createElement("script");i.setAttribute("type","text/javascript"),i.innerHTML=e,document.head.appendChild(i)}s.statusText="success","function"==typeof s.success&&s.success.call(s.this?s.this:this,e,s)}else s.statusText="error",o(t);"function"==typeof s.complete&&s.complete.call(s.this?s.this:this,e,s)}),r.addEventListener("error",o),r.addEventListener("progress",function(t){"function"==typeof s.progress&&s.progress.call(s.this?s.this:this,t,s)});var a="responseType"in r;function o(t){"function"==typeof s.error&&s.error.call(s.this?s.this:this,t,s)}if(s.beforeSend&&(r=s.beforeSend.call(s.this?s.this:this,r,s)),a&&s.dataType)try{r.responseType=s.dataType}catch(t){o(t)}try{r.open(s.method||"GET",s.url,!0)}catch(t){o(t)}"POST"==s.method&&r.setRequestHeader("Content-type","application/x-www-form-urlencoded");try{r.send("POST"==s.method?i:null)}catch(t){o(t)}return this},e.prototype.loadJSON=function(t,e,i){return(i=i||{}).dataType="json",i.complete=e,this.ajax(t,i),this},t.stuQuery=e,t.S=function(t){return new e(t)}}(window||this),SVG.prototype.clear=function(){return this.nodes=new Array,this.clippaths=new Array,this.patterns=new Array,this.draw(),this},SVG.prototype.draw=function(t){var e="<desc>Created by stuQuery SVG</desc>";if(0<this.patterns.length)for(var i=0;i<this.patterns.length;i++)e+=this.patterns[i];if(0<this.clippaths.length){e+="<defs>";for(i=0;i<this.clippaths.length;i++){if(e+='<clipPath id="'+this.clippaths[i].id+'">',this.clippaths[i].type){for(var s in this.clippaths[i].update(),e+="<"+this.clippaths[i].type,this.clippaths[i])"type"!=s&&"object"!=typeof this.clippaths[i][s]&&"function"!=typeof this.clippaths[i][s]&&"attributes"!=s&&(e+=" "+s+'="'+this.clippaths[i][s]+'"');e+=" />"}e+="</clipPath>"}e+="</defs>"}function r(t,e){n=t[e];var i="",s=n.type,r=n.text?n.text.split(/\n/):[];if(n.type){for(var h in i+="<"+s,n.update(),n)"type"!=h&&"object"!=typeof n[h]&&"function"!=typeof n[h]&&"attributes"!=h&&("text"==h&&1<r.length?i+="":i+=" "+h+'="'+n[h]+'"');for(var a in i+=' id="'+n.id+'"',n.attributes)i+=" "+a+'="'+("clip-path"==a?"url(#":"")+n.attributes[a]+("clip-path"==a?")":"")+'"';if(n.text){i+=">";var o=.5*r.length-.5;for(a=0;a<r.length;a++,1.2)i+="<tspan"+(0==a?' dy="-'+1.2*o+'em"':' x="'+(n.attributes.x||n.x)+'" dy="1.2em"')+">"+r[a]+"</tspan>";i+="</"+s+">"}else i+=" />"}return i}for(i=0;i<this.nodes.length;i++)e+=r(this.nodes,i);this.paper.html(e);for(i=0;i<this.nodes.length;i++)if(this.nodes[i].events)for(var h=0;h<this.nodes[i].events.length;h++)S("#"+this.nodes[i].id).on(this.nodes[i].events[h].type,this.nodes[i].events[h].attr,this.nodes[i].events[h].fn);return this};